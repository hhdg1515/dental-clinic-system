class GlobalCacheManager{constructor(){this.dateCache=new Map,this.allAppointmentsCache=null,this.cancelledAppointmentsCache=null,this.dentalChartsCache=new Map,this.dateCacheTimestamps=new Map,this.allAppointmentsTimestamp=null,this.cancelledAppointmentsTimestamp=null,this.dentalChartTimestamps=new Map,this.CACHE_DURATION=3e5,this.DENTAL_CHART_CACHE_DURATION=432e5,this.MAX_DATE_CACHE=30,this.stats={hits:0,misses:0,savedReads:0}}getDateCache(t){return this.isDateCacheValid(t)?(this.stats.hits++,this.stats.savedReads++,this.dateCache.get(t)):(this.stats.misses++,null)}setDateCache(t,e){this.dateCache.size>=this.MAX_DATE_CACHE&&this.evictOldestDateCache(),this.dateCache.set(t,e),this.dateCacheTimestamps.set(t,Date.now())}isDateCacheValid(t){if(!this.dateCache.has(t)||!this.dateCacheTimestamps.has(t))return!1;const e=this.dateCacheTimestamps.get(t);return Date.now()-e<this.CACHE_DURATION}evictOldestDateCache(){let t=null,e=1/0;for(const[s,a]of this.dateCacheTimestamps.entries())a<e&&(e=a,t=s);t&&(this.dateCache.delete(t),this.dateCacheTimestamps.delete(t))}invalidateDate(t){this.dateCache.has(t)&&(this.dateCache.delete(t),this.dateCacheTimestamps.delete(t))}getAllCache(){return this.isAllCacheValid()?(this.stats.hits++,this.stats.savedReads++,this.allAppointmentsCache):(this.stats.misses++,null)}setAllCache(t){this.allAppointmentsCache=t,this.allAppointmentsTimestamp=Date.now()}isAllCacheValid(){if(!this.allAppointmentsCache||!this.allAppointmentsTimestamp)return!1;return Date.now()-this.allAppointmentsTimestamp<this.CACHE_DURATION}invalidateAll(){this.allAppointmentsCache=null,this.allAppointmentsTimestamp=null}getCancelledCache(){return this.isCancelledCacheValid()?(this.stats.hits++,this.stats.savedReads++,this.cancelledAppointmentsCache):(this.stats.misses++,null)}setCancelledCache(t){this.cancelledAppointmentsCache=t,this.cancelledAppointmentsTimestamp=Date.now()}isCancelledCacheValid(){if(!this.cancelledAppointmentsCache||!this.cancelledAppointmentsTimestamp)return!1;return Date.now()-this.cancelledAppointmentsTimestamp<this.CACHE_DURATION}invalidateCancelled(){this.cancelledAppointmentsCache=null,this.cancelledAppointmentsTimestamp=null}onAppointmentCreated(t){this.invalidateDate(t),this.invalidateAll()}onAppointmentUpdated(t,e){this.invalidateDate(t),"cancelled"===e&&(this.invalidateAll(),this.invalidateCancelled())}onAppointmentDeleted(t){this.invalidateDate(t),this.invalidateAll()}getDentalChartCache(t){return this.isDentalChartCacheValid(t)?(this.stats.hits++,this.stats.savedReads++,this.dentalChartsCache.get(t)):(this.stats.misses++,null)}setDentalChartCache(t,e){this.dentalChartsCache.set(t,e),this.dentalChartTimestamps.set(t,Date.now())}isDentalChartCacheValid(t){if(!this.dentalChartsCache.has(t)||!this.dentalChartTimestamps.has(t))return!1;const e=this.dentalChartTimestamps.get(t);return Date.now()-e<this.DENTAL_CHART_CACHE_DURATION}invalidateDentalChart(t){this.dentalChartsCache.has(t)&&(this.dentalChartsCache.delete(t),this.dentalChartTimestamps.delete(t))}onDentalChartUpdated(t){this.invalidateDentalChart(t)}clearAll(){this.dateCache.clear(),this.dateCacheTimestamps.clear(),this.allAppointmentsCache=null,this.allAppointmentsTimestamp=null,this.cancelledAppointmentsCache=null,this.cancelledAppointmentsTimestamp=null,this.dentalChartsCache.clear(),this.dentalChartTimestamps.clear()}cleanupExpired(){const t=Date.now();for(const[e,s]of this.dateCacheTimestamps.entries())t-s>=this.CACHE_DURATION&&(this.dateCache.delete(e),this.dateCacheTimestamps.delete(e));this.allAppointmentsTimestamp&&t-this.allAppointmentsTimestamp>=this.CACHE_DURATION&&this.invalidateAll(),this.cancelledAppointmentsTimestamp&&t-this.cancelledAppointmentsTimestamp>=this.CACHE_DURATION&&this.invalidateCancelled();for(const[e,s]of this.dentalChartTimestamps.entries())t-s>=this.DENTAL_CHART_CACHE_DURATION&&(this.dentalChartsCache.delete(e),this.dentalChartTimestamps.delete(e))}getStats(){const t=this.stats.hits+this.stats.misses>0?(this.stats.hits/(this.stats.hits+this.stats.misses)*100).toFixed(1):"0.0";return{hits:this.stats.hits,misses:this.stats.misses,hitRate:`${t}%`,savedReads:this.stats.savedReads,dateCacheSize:this.dateCache.size,hasAllCache:!!this.allAppointmentsCache,hasCancelledCache:!!this.cancelledAppointmentsCache,totalCacheSize:this.dateCache.size+(this.allAppointmentsCache?1:0)+(this.cancelledAppointmentsCache?1:0)}}printStats(){this.getStats()}}window.cacheManager=new GlobalCacheManager,setInterval(()=>{window.cacheManager.cleanupExpired()},6e4),"undefined"!=typeof module&&module.exports&&(module.exports=GlobalCacheManager);