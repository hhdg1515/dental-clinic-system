if(void 0===patientName)var patientName=null;function recordDebugLog(t,e){try{if("undefined"==typeof window)return;window.__intranetDebugLog||(window.__intranetDebugLog=[]),window.__intranetDebugLog.push({ts:(new Date).toISOString(),label:t,payload:e})}catch(t){}}"undefined"==typeof window||window.__intranetDebugLog||(window.__intranetDebugLog=[]);class FirebaseDataService{constructor(){this.db=null,this.auth=null,this.storage=null,this.isInitialized=!1,this.clinicLocations=["arcadia","irvine","south-pasadena","rowland-heights","eastvale"],this.init()}async init(){try{await this.waitForFirebase(),this.db=window.firebase.db,this.auth=window.firebase.auth,this.storage=window.firebase.storage,this.isInitialized=!0}catch(t){this.isInitialized=!1}}waitForFirebase(){return new Promise((t,e)=>{let a=0;const i=()=>{window.firebase&&window.firebase.db&&window.firebase.auth&&window.firebase.storage?t():a>=100?e(new Error("Firebase services not available")):(a++,setTimeout(i,100))};i()})}async ensureReady(){this.isInitialized||await this.init();let t=0;for(;(!this.isInitialized||!window.firebase?.db)&&t<10;)await new Promise(t=>setTimeout(t,300)),this.isInitialized||await this.init(),t++;if(!this.isInitialized||!window.firebase?.db)throw new Error("Firebase services not available after multiple retry attempts")}validateDatabase(){const t=window.firebase?.db;if(!t)throw new Error("Firebase database not available - window.firebase.db is null or undefined");if("object"!=typeof t||!t.app)throw new Error("Firebase database object is invalid - missing app property");return t}getAccessibleClinics(t,e){const a=("boss"===t||"owner"===t?this.clinicLocations:e||[]).map(t=>this.normalizeClinicId(t)).filter(Boolean);return Array.from(new Set(a))}normalizeStatus(t){if(!t)return"scheduled";return{confirmed:"scheduled",scheduled:"scheduled",completed:"completed",cancelled:"cancelled",pending:"pending",declined:"declined",arrived:"arrived","no-show":"no-show"}[t.toLowerCase()]||"scheduled"}normalizeClinicId(t){if(!t)return null;"string"!=typeof t&&(t=String(t));const e=t.trim().toLowerCase();return e?e.includes("arcadia")?"arcadia":e.includes("rowland")?"rowland-heights":e.includes("pasadena")?"south-pasadena":e.includes("irvine")?"irvine":e.includes("eastvale")?"eastvale":e.replace(/[^a-z0-9\s-]/g,"").replace(/[\s_]+/g,"-"):null}resolveClinicInfo(t){const e=t?.clinicLocation??t?.clinicId??t?.location??t?.clinic??t?.clinicName??"",a=this.normalizeClinicId(e);return{key:a,label:a?this.getLocationFromClinicId(a):e||""}}async getAppointmentsForDate(t,e=null,a=[],i=!1){try{let n;await this.ensureReady();try{n=this.validateDatabase()}catch(t){return[]}const{collection:s,getDocs:o,query:r,where:c,orderBy:l,Timestamp:d}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),p=this.getAccessibleClinics(e,a),w=r(s(n,"appointments"),c("appointmentDate","==",t)),m=await o(w),h=[];let u=0,f=0,g=0;const b=new Set(p);return m.forEach(e=>{u++;const a=e.data(),n=this.resolveClinicInfo(a);if(!n.key)return void f++;if(!b.has(n.key))return void f++;if(!i&&("cancelled"===a.status||"declined"===a.status))return void g++;let s="",o=t;if(a.appointmentTime)s=a.appointmentTime;else if(a.appointmentDateTime){const t=a.appointmentDateTime.toDate();s=`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}if(a.appointmentDate)o=a.appointmentDate;else if(a.appointmentDateTime){const t=a.appointmentDateTime.toDate();o=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}if(o===t){const t=this.normalizeStatus(a.status),i=a.service||a.serviceType||a.serviceName||"General Consultation",r=a.id||a.appointmentId||null;h.push({...a,legacyId:r,id:e.id,clinicLocation:n.key,clinicId:n.key,location:n.label||a.location||a.clinicLocation||"",time:s,dateKey:o,date:o,status:t,service:i})}}),h}catch(t){return[]}}async getAppointmentsForDateRange(t,e,a=null,i=[]){try{let n;await this.ensureReady();try{n=this.validateDatabase()}catch(t){return{}}const{collection:s,getDocs:o,query:r,where:c}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),l=this.getAccessibleClinics(a,i),d=r(s(n,"appointments"),c("appointmentDate",">=",t),c("appointmentDate","<=",e)),p=await o(d),w={},m=new Set(l);return p.forEach(a=>{const i=a.data(),n=this.resolveClinicInfo(i);if(!n.key||!m.has(n.key))return;if("pending"===i.status||"cancelled"===i.status||"declined"===i.status)return;let s="",o="";if(i.appointmentTime)s=i.appointmentTime;else if(i.appointmentDateTime){const t=i.appointmentDateTime.toDate();s=`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}if(i.appointmentDate)o=i.appointmentDate;else if(i.appointmentDateTime){const t=i.appointmentDateTime.toDate();o=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}if(o>=t&&o<=e){w[o]||(w[o]=[]);const t=this.normalizeStatus(i.status),e=i.service||i.serviceType||i.serviceName||"General Consultation",r=i.id||i.appointmentId||null;w[o].push({...i,legacyId:r,id:a.id,clinicLocation:n.key,clinicId:n.key,time:s,dateKey:o,date:o,location:n.label||i.location||i.clinicLocation||"",status:t,service:e})}}),w}catch(t){return{}}}async getAllAppointments(t=null,e=[],a=!0){try{let i;await this.ensureReady();try{i=this.validateDatabase()}catch(t){return[]}const{collection:n,getDocs:s,query:o,where:r}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),c=this.getAccessibleClinics(t,e),l=new Date,d=new Date(l.getFullYear(),l.getMonth()-3,l.getDate()),p=new Date(l.getFullYear()+1,l.getMonth(),l.getDate()),w=d.toISOString().split("T")[0],m=p.toISOString().split("T")[0],h=o(n(i,"appointments"),r("appointmentDate",">=",w),r("appointmentDate","<=",m)),u=await s(h),f=[],g=new Set(c);return u.forEach(t=>{const e=t.data(),i=this.resolveClinicInfo(e);if(!i.key||!g.has(i.key))return;if(!a&&("cancelled"===e.status||"declined"===e.status))return;let n="",s="";if(e.appointmentTime)n=e.appointmentTime;else if(e.appointmentDateTime){const t=e.appointmentDateTime.toDate();n=`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}if(e.appointmentDate)s=e.appointmentDate;else if(e.appointmentDateTime){const t=e.appointmentDateTime.toDate();s=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}const o=this.normalizeStatus(e.status),r=e.service||e.serviceType||e.serviceName||"General Consultation",c=e.id||e.appointmentId||null;f.push({...e,legacyId:c,id:t.id,clinicLocation:i.key,clinicId:i.key,time:n,dateKey:s,location:i.label||e.location||e.clinicLocation||"",status:o,service:r})}),f}catch(t){return[]}}async createAppointmentTimestamp(t,e){try{const{Timestamp:a}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),[i,n,s]=t.split("-").map(Number),[o,r]=e.split(":").map(Number),c=new Date(i,n-1,s,o,r,0,0);return a.fromDate(c)}catch(t){const{Timestamp:e}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js");return e.fromDate(new Date)}}async addAppointment(t,e=null,a=[]){try{await this.ensureReady();const{collection:i,addDoc:n,doc:s,setDoc:o}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),r=this.getClinicIdFromLocation(t.location);if(!this.getAccessibleClinics(e,a).includes(r))throw new Error(`Access denied: You don't have permission to create appointments for ${r}`);const c=await this.createAppointmentTimestamp(t.date,t.time),l={patientName:t.patientName,service:t.service,appointmentTime:t.time,appointmentDate:t.date,appointmentDateTime:c,status:"scheduled",clinicLocation:r,phone:t.phone||"",email:t.email||`${t.patientName.toLowerCase().replace(/\s+/g,".")}@email.com`,notes:t.notes||"",dateKey:t.date,createdAt:(new Date).toISOString(),clinicId:r},d=i(this.validateDatabase(),"appointments");return{id:(await n(d,l)).id,...l}}catch(t){throw t}}async updateAppointmentStatus(t,e,a={},i=null,n=[],s=null){try{await this.ensureReady();const{doc:o,updateDoc:r,deleteDoc:c,collection:l,addDoc:d}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js");recordDebugLog("firebase.updateAppointmentStatus.start",{appointmentId:t,newStatus:e,additionalData:a,userRole:i,userClinics:n,appointmentContext:s});const p=await this.findAppointmentById(t,i,n,s);if(recordDebugLog("firebase.updateAppointmentStatus.found",p),p&&p.appointmentDateTime){p.appointmentDateTime.toDate().toISOString().split("T")[0]}if(!p)throw new Error("Appointment not found");const w=p.clinicLocation||p.location,m=(p.dateKey||(p.appointmentDateTime?p.appointmentDateTime.toDate().toISOString().split("T")[0]:(new Date).toISOString().split("T")[0]),this.getAccessibleClinics(i,n)),h=this.normalizeClinicId(w);if(!h||!m.includes(h))throw new Error(`Access denied to clinic: ${h}`);if("cancelled"===e){const e={...p,status:"cancelled",cancelledAt:(new Date).toISOString(),cancelReason:a.reason||"Unknown",cancelNotes:a.notes||""},i=this.validateDatabase(),n=l(i,"cancelledAppointments");await d(n,e),await c(o(i,"appointments",t))}else{const i={status:e,...a,lastUpdated:(new Date).toISOString()},n=this.validateDatabase();await r(o(n,"appointments",t),i)}return!0}catch(t){throw t}}async updateAppointment(t,e,a=null,i=[]){try{await this.ensureReady();const{doc:n,updateDoc:s,getDoc:o}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),r=await this.findAppointmentById(t,a,i);if(!r)throw new Error("Appointment not found");const c=this.getAccessibleClinics(a,i),l=this.normalizeClinicId(r.clinicLocation||r.location);if(!l||!c.includes(l))throw new Error(`No permission to update appointments for ${l}`);const d=this.validateDatabase(),p={...e,lastUpdated:(new Date).toISOString()};return e.name&&(p.patientName=e.name,delete p.name),await s(n(d,"appointments",t),p),!0}catch(t){throw t}}async deleteAppointment(t,e=null,a=[]){try{await this.ensureReady();const{doc:i,deleteDoc:n}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),s=await this.findAppointmentById(t,e,a);if(!s)throw new Error("Appointment not found");const o=s.clinicLocation||s.location,r=this.getAccessibleClinics(e,a),c=this.normalizeClinicId(o);if(!c||!r.includes(c))throw new Error(`Access denied to delete appointments for ${c}`);const l=this.validateDatabase();return await n(i(l,"appointments",t)),!0}catch(t){throw t}}async findAppointmentById(t,e=null,a=[],i=null){try{await this.ensureReady();const{doc:n,getDoc:s,collection:o,getDocs:r,query:c,where:l,limit:d}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),p=this.getAccessibleClinics(e,a),w=this.validateDatabase(),m=async(t,e="primary")=>{if(!t)return null;recordDebugLog("firebase.findAppointmentById.tryId",{label:e,docId:t});const a=n(w,"appointments",t),i=await s(a);if(!i.exists())return null;const o=i.data(),r=this.normalizeClinicId(o.clinicLocation||o.location);if(!r||!p.includes(r))throw new Error("No permission to access this appointment");return{id:i.id,...o}};let h=await m(t,"primary");if(h)return h;const u=i?.legacyId||i?.appointmentId||null;if(!h&&u&&u!==t)try{if(h=await m(u,"legacy"),h)return h}catch(t){}return recordDebugLog("firebase.findAppointmentById.failed",{appointmentId:t,appointmentContext:i}),null}catch(t){return null}}async getPendingConfirmations(t=null,e=[]){try{await this.ensureReady();const{collection:a,getDocs:i,query:n,orderBy:s}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),o=this.validateDatabase(),r=n(a(o,"pendingConfirmations"),s("createdAt","desc")),c=await i(r),l=[];return c.forEach(a=>{const i=a.data(),n=this.getClinicIdFromLocation(i.location);this.getAccessibleClinics(t,e).includes(n)&&l.push({...i,legacyId:i.id||i.appointmentId||null,id:a.id})}),l}catch(t){return[]}}async addPendingConfirmation(t){try{await this.ensureReady();const{collection:e,addDoc:a}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),i={...t,createdAt:(new Date).toISOString()},n=e(this.validateDatabase(),"pendingConfirmations");return{id:(await a(n,i)).id,...i}}catch(t){throw t}}async removePendingConfirmation(t){try{await this.ensureReady();const{doc:e,deleteDoc:a}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),i=this.validateDatabase();return await a(e(i,"pendingConfirmations",t)),!0}catch(t){throw t}}async getCancelledAppointments(t=null,e=[]){try{let a;await this.ensureReady();try{a=this.validateDatabase()}catch(t){return[]}const{collection:i,getDocs:n,query:s,orderBy:o}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),r=[],c=this.getAccessibleClinics(t,e);for(const t of c){const e=s(i(a,"cancelledAppointments",t,"appointments"),o("cancelledAt","desc"));(await n(e)).forEach(t=>{const e=t.data();r.push({...e,legacyId:e.id||e.appointmentId||null,id:t.id})})}return r}catch(t){return[]}}async getPatientProfile(t){try{await this.ensureReady();const{doc:e,getDoc:a}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),i=t.toLowerCase().replace(/\s+/g,"_"),n=e(this.validateDatabase(),"patientProfiles",i),s=await a(n);return s.exists()?s.data():null}catch(t){return null}}async setPatientProfile(t,e){try{await this.ensureReady();const{doc:a,setDoc:i}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),n=t.toLowerCase().replace(/\s+/g,"_"),s=a(this.validateDatabase(),"patientProfiles",n),o={patientName:t,detailedInfo:e,lastUpdated:(new Date).toISOString()};return await i(s,o,{merge:!0}),o}catch(t){throw t}}getClinicIdFromLocation(t){return this.normalizeClinicId(t)||"arcadia"}getLocationFromClinicId(t){return t.split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}generateAppointmentId(){return"app_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}async subscribeToNewAppointments(t,e,a){try{await this.ensureReady();const{collection:i,query:n,where:s,orderBy:o,onSnapshot:r}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),c=this.getAccessibleClinics(t,e),l=this.validateDatabase(),d=n(i(l,"appointments"),s("clinicLocation","in",c),s("status","==","pending"),o("appointmentDateTime","asc"));return r(d,t=>{const e=[];t.forEach(t=>{const a=t.data(),i=a.appointmentDateTime?a.appointmentDateTime.toDate():new Date,n=this.resolveClinicInfo(a);e.push({...a,legacyId:a.id||a.appointmentId||null,id:t.id,clinicLocation:n.key,clinicId:n.key,time:i.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),dateKey:i.toISOString().split("T")[0],location:n.label||a.location||a.clinicLocation||"",appointmentDateTime:i})}),a(e)},t=>{a([])})}catch(t){return()=>{}}}async getPendingAppointmentsCount(t,e){try{await this.ensureReady();const{collection:a,query:i,where:n,getCountFromServer:s}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),o=this.getAccessibleClinics(t,e),r=this.validateDatabase(),c=i(a(r,"appointments"),n("clinicLocation","in",o),n("status","==","pending"));return(await s(c)).data().count}catch(t){return 0}}async uploadMedicalRecord(t,e,a=null){try{await this.ensureReady();const{collection:i,addDoc:n}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js");let s=0;const o=setInterval(()=>{s+=20,a&&a(Math.min(s,90))},100),r=await this.fileToBase64(e);clearInterval(o),a&&a(95);const c=i(this.validateDatabase(),"medicalRecords"),l={userId:t,filename:e.name,originalName:e.name,size:e.size,type:e.type,base64Data:r,uploadedAt:new Date},d=await n(c,l);return a&&a(100),{id:d.id,...l}}catch(t){throw t}}fileToBase64(t){return new Promise((e,a)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(i.result),i.onerror=t=>a(t)})}async getMedicalRecords(t){try{await this.ensureReady();const{collection:e,query:a,where:i,getDocs:n,orderBy:s}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),o=this.validateDatabase(),r=a(e(o,"medicalRecords"),i("userId","==",t),s("uploadedAt","desc")),c=await n(r),l=[];return c.forEach(t=>{const e=t.data();l.push({...e,legacyId:e.id||null,id:t.id})}),l}catch(t){throw t}}async deleteMedicalRecord(t){try{await this.ensureReady();const{doc:e,deleteDoc:a}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),i=this.validateDatabase();return await a(e(i,"medicalRecords",t)),!0}catch(t){throw t}}async renameMedicalRecord(t,e){try{await this.ensureReady();const{doc:a,updateDoc:i}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),n=a(this.validateDatabase(),"medicalRecords",t);return await i(n,{originalName:e,updatedAt:new Date}),!0}catch(t){throw t}}async downloadMedicalRecord(t,e){try{const a=atob(t.split(",")[1]),i=new Array(a.length);for(let t=0;t<a.length;t++)i[t]=a.charCodeAt(t);const n=new Uint8Array(i),s=t.substring(t.indexOf(":")+1,t.indexOf(";")),o=new Blob([n],{type:s}),r=window.URL.createObjectURL(o),c=document.createElement("a");return c.style.display="none",c.href=r,c.download=e,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(r),document.body.removeChild(c),!0}catch(t){throw t}}async getDentalChart(t){await this.ensureReady();const{doc:e,getDoc:a}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),i=e(this.validateDatabase(),"dentalCharts",t),n=await a(i);return n.exists()?{id:n.id,...n.data()}:null}validateToothNumber(t){const e=parseInt(t);if(isNaN(e)||e<1||e>32)throw new Error(`Invalid tooth number: ${t}. Must be 1-32.`);return e}validateToothStatus(t){const e=["healthy","monitor","cavity","filled","missing","implant","root-canal","post-op","urgent"];if(!e.includes(t))throw new Error(`Invalid tooth status: ${t}. Must be one of: ${e.join(", ")}`);return t}validateFileUpload(t){if(!t)throw new Error("No file provided");if(t.size>5242880)throw new Error(`File too large: ${(t.size/1024/1024).toFixed(2)}MB. Maximum 5MB allowed.`);if(!["image/jpeg","image/png","image/jpg","application/pdf"].includes(t.type))throw new Error(`Invalid file type: ${t.type}. Only JPEG, PNG, and PDF allowed.`);return!0}async updateToothStatus(t,e,a){await this.ensureReady();const i=this.validateToothNumber(e),n=this.validateToothStatus(a.status),{doc:s,updateDoc:o}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),r=s(this.validateDatabase(),"dentalCharts",t);return await o(r,{[`teeth.${i}.status`]:n,[`teeth.${i}.lastUpdated`]:(new Date).toISOString(),lastUpdated:(new Date).toISOString()}),!0}async addToothTreatment(t,e,a){await this.ensureReady();const i=this.validateToothNumber(e),{doc:n,getDoc:s,updateDoc:o,arrayUnion:r}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),c=n(this.validateDatabase(),"dentalCharts",t),l=await s(c);if(!l.exists())throw new Error("Dental chart not found");const d={id:`treatment-${Date.now()}`,date:(new Date).toISOString(),createdBy:this.auth.currentUser?.uid||"unknown",...a},p=l.data();return p.teeth||(p.teeth={}),p.teeth[i]||(p.teeth[i]={status:"healthy",treatments:[]}),p.teeth[i].treatments||(p.teeth[i].treatments=[]),p.teeth[i].treatments.push(d),await o(c,{[`teeth.${i}.treatments`]:p.teeth[i].treatments,[`teeth.${i}.lastUpdated`]:(new Date).toISOString(),lastUpdated:(new Date).toISOString()}),d}async uploadToothAttachment(t,e,a){await this.ensureReady();const i=this.validateToothNumber(e);this.validateFileUpload(a);if(a.size<51200){const t=await this.fileToBase64(a);return{type:"base64",filename:a.name,mimeType:a.type,fileSize:a.size,base64Data:t}}{const{ref:e,uploadBytes:n,getDownloadURL:s}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-storage.js"),o=this.storage,r=`dentalCharts/${t}/tooth_${i}/${Date.now()}_${a.name}`,c=e(o,r),l=await n(c,a),d=await s(l.ref);return{type:"storage",filename:a.name,mimeType:a.type,fileSize:a.size,storagePath:r,downloadURL:d}}}async deleteToothTreatment(t,e,a){await this.ensureReady();const i=this.validateToothNumber(e),{doc:n,getDoc:s,updateDoc:o}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),r=n(this.validateDatabase(),"dentalCharts",t),c=await s(r);if(c.exists()){const t=c.data(),e=t.teeth?.[i];if(e?.treatments){const t=e.treatments.filter(t=>t.id!==a);await o(r,{[`teeth.${i}.treatments`]:t,[`teeth.${i}.lastUpdated`]:(new Date).toISOString(),lastUpdated:(new Date).toISOString()})}}return!0}async initializeDentalChart(t,e){await this.ensureReady();const{doc:a,setDoc:i}=await import("https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"),n=a(this.validateDatabase(),"dentalCharts",t),s={};for(let t=1;t<=32;t++)s[t.toString()]={status:"healthy",treatments:[],lastUpdated:(new Date).toISOString()};return await i(n,{userId:t,patientName:e,lastUpdated:(new Date).toISOString(),teeth:s}),!0}}let firebaseDataService=null;if("undefined"!=typeof window){const t=()=>{window.firebase&&window.firebase.db?(firebaseDataService=new FirebaseDataService,window.firebaseDataService=firebaseDataService):setTimeout(t,100)};t()}"undefined"!=typeof module&&module.exports?module.exports=FirebaseDataService:"undefined"!=typeof window&&(window.FirebaseDataService=FirebaseDataService),recordDebugLog("firebase.findAppointmentById.fallbackQuery",{patientName:patientName,appointmentDate:appointmentDate,appointmentTime:appointmentTime});