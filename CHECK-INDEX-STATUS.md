# æ£€æŸ¥ Firestore ç´¢å¼•çŠ¶æ€

## å½“å‰éœ€è¦çš„ç´¢å¼•

**é›†åˆï¼š** `dentalChartSnapshots`

**å­—æ®µç»„åˆï¼š**
- `userId` (Ascending)
- `createdAt` (Descending)

---

## æŸ¥çœ‹ç´¢å¼•çŠ¶æ€

### æ–¹æ³• 1ï¼šFirebase Console
1. æ‰“å¼€ï¼šhttps://console.firebase.google.com/project/dental-clinic-demo-ce94b/firestore/indexes
2. æŸ¥çœ‹ "Composite" æ ‡ç­¾
3. æ‰¾åˆ° `dentalChartSnapshots` é›†åˆçš„ç´¢å¼•
4. çŠ¶æ€åº”è¯¥æ˜¯ï¼š
   - â³ **Building** - æ­£åœ¨æ„å»ºï¼ˆç­‰å¾…ä¸­ï¼‰
   - âœ… **Enabled** - å·²å¯ç”¨ï¼ˆå¯ä»¥ä½¿ç”¨ï¼‰
   - âŒ **Error** - æ„å»ºå¤±è´¥ï¼ˆéœ€è¦é‡æ–°åˆ›å»ºï¼‰

### æ–¹æ³• 2ï¼šç›´æ¥ç‚¹å‡»é”™è¯¯é“¾æ¥
ä½ çš„é”™è¯¯ä¿¡æ¯ä¸­å·²ç»åŒ…å«äº†ç›´æ¥åˆ›å»ºç´¢å¼•çš„é“¾æ¥ï¼Œç‚¹å‡»å®ƒä¼šè‡ªåŠ¨å¡«å¥½æ‰€æœ‰é…ç½®ã€‚

---

## ç´¢å¼•æ„å»ºæ—¶é—´

- **ç©ºé›†åˆæˆ–å°‘é‡æ•°æ®**ï¼š10-30 ç§’
- **ä¸­ç­‰æ•°æ®é‡**ï¼ˆ< 1000 æ¡ï¼‰ï¼š1-3 åˆ†é’Ÿ
- **å¤§é‡æ•°æ®**ï¼ˆ> 10000 æ¡ï¼‰ï¼š5-15 åˆ†é’Ÿ

---

## æµ‹è¯•æ­¥éª¤

ç´¢å¼•çŠ¶æ€å˜ä¸º "Enabled" åï¼š

1. **åˆ·æ–°åº”ç”¨é¡µé¢**ï¼ˆCtrl + Shift + Rï¼‰
2. **æ‰“å¼€æ‚£è€…è´¦æˆ·**ï¼ˆä¾‹å¦‚ Liu Liuï¼‰
3. **åˆ‡æ¢åˆ° Chart History æ ‡ç­¾**
4. **ç‚¹å‡» "Create Snapshot"**
5. **éªŒè¯ï¼š**
   - âœ… åº”è¯¥æ˜¾ç¤º "âœ… Snapshot created successfully"
   - âœ… å¿«ç…§åˆ—è¡¨åº”è¯¥æ˜¾ç¤ºæ–°åˆ›å»ºçš„å¿«ç…§
   - âœ… ä¸å†æœ‰ç´¢å¼•é”™è¯¯

---

## å¦‚æœç´¢å¼•æ„å»ºå¤±è´¥

### å¯èƒ½åŸå› ï¼š
1. **æ•°æ®æ ¼å¼ä¸ä¸€è‡´**ï¼šæŸäº›æ–‡æ¡£ç¼ºå°‘ `userId` æˆ– `createdAt` å­—æ®µ
2. **æƒé™ä¸è¶³**ï¼šFirebase é¡¹ç›®æƒé™é—®é¢˜
3. **é…é¢é™åˆ¶**ï¼šè¶…è¿‡å…è´¹è®¡åˆ’çš„ç´¢å¼•æ•°é‡é™åˆ¶

### è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥ç°æœ‰æ•°æ®ï¼Œç¡®ä¿æ‰€æœ‰å¿«ç…§æ–‡æ¡£éƒ½æœ‰ `userId` å’Œ `createdAt`
2. åˆ é™¤å¹¶é‡æ–°åˆ›å»ºç´¢å¼•
3. å‡çº§åˆ° Blaze è®¡åˆ’ï¼ˆæŒ‰éœ€ä»˜è´¹ï¼‰

---

## æœªæ¥é¿å…ç´¢å¼•é—®é¢˜

### æœ€ä½³å®è·µï¼š

**åœ¨æœ¬åœ°å¼€å‘æ—¶åˆ›å»º `firestore.indexes.json`ï¼š**

```json
{
  "indexes": [
    {
      "collectionGroup": "dentalChartSnapshots",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "userId",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "createdAt",
          "order": "DESCENDING"
        }
      ]
    }
  ],
  "fieldOverrides": []
}
```

ç„¶åä½¿ç”¨ Firebase CLI éƒ¨ç½²ï¼š
```bash
firebase deploy --only firestore:indexes
```

---

## æ€»ç»“

âœ… **æƒé™é—®é¢˜å·²è§£å†³**ï¼ˆé”™è¯¯ä» `permission denied` å˜æˆ `requires index`ï¼‰

â³ **å½“å‰é—®é¢˜ï¼šç¼ºå°‘ç´¢å¼•**

ğŸ”§ **è§£å†³æ–¹æ¡ˆï¼šç‚¹å‡»é”™è¯¯ä¸­çš„é“¾æ¥åˆ›å»ºç´¢å¼•**

â±ï¸ **ç­‰å¾…æ—¶é—´ï¼š1-5 åˆ†é’Ÿ**

---

*åˆ›å»ºæ—¶é—´ï¼š2025-11-27*
*é¡¹ç›®ï¼šDental Clinic System - Chart History åŠŸèƒ½*
